#- name: create time stamp for play
# set_fact:
#   datetime: "{{ lookup('pipe','date +%Y-%m-%d-%H-%M') }}"

#- name: Create file
#  file: /home/yuji/network_automation/output/"{{ datetime }}{{inventory_hostname }}"-interfaces
#  state: touch

- name: Get Datetime
  set_fact:
    datetime: "{{ lookup('pipe','date +%Y-%m-%d-%H-%M') }}"
  run_once: true

- name: ensure directory exists
  file:
    path: /home/yuji/network_automation/output/interfaces-json/{{ datetime }}
    state: directory
  run_once: true
    
- name: ensure file exists
  file:
    path: /home/yuji/network_automation/output/interfaces-json/{{ datetime }}/{{ inventory_hostname }}-interfaces
    state: touch

- name: Run Command and parse with json parser
  ansible.utils.cli_parse:
    command: show interface | json
    parser:
      name: ansible.netcommon.json
    set_fact: interfaces


- name: Copy output to file
  local_action: 
    module: copy 
    content: "{{ interfaces }}" 
    dest: /home/yuji/network_automation/output/interfaces-json/{{ datetime }}/{{ inventory_hostname }}-interfaces
